/*! ethz-raytracer - v0.0.1 - 2013-10-24
* Copyright (c) 2013 ; Licensed  */
(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m;a=function(){function a(a,b,c,d,e,f,g){this.position=a,this.direction=b,this.upDirection=c,this.distance=d,this.fieldOfView=e,this.width=f,this.height=g,this.calibrateCamera()}return a.prototype.calibrateCamera=function(){return this.direction=this.direction.toUnitVector(),this.rightDirection=this.direction.cross(this.upDirection),this.imagePaneHeight=2*Math.tan(this.fieldOfView/2)*this.distance,this.imagePaneWidth=this.imagePaneHeight/this.height*this.width,this.imageCenter=this.position.add(this.direction.multiply(this.distance))},a.prototype.getCenter=function(){return this.imageCenter},a}(),b=function(){function a(a,b,c){a instanceof Vector&&(b=a.elements[1],c=a.elements[2],a=a.elements[0]),0>a&&(a=0),0>b&&(b=0),0>c&&(c=0),a>1&&(a=1),b>1&&(b=1),c>1&&(c=1),this.val=$V([a,b,c])}return a.random=function(){return new a(Math.random(),Math.random(),Math.random())},a.prototype.add=function(b){return new a(this.val.add(b.val))},a.prototype.multiply=function(b){return new a(this.val.multiply(b))},a.prototype.multiplyColor=function(b){return new a(this.val.elements[0]*b.val.elements[0],this.val.elements[1]*b.val.elements[1],this.val.elements[2]*b.val.elements[2])},a.prototype.toArray=function(){return this.val.dup().elements},a.prototype.toVector=function(){return this.val.dup()},a}(),c=function(){function a(a,b,c,d,e,f,g,h){this.axis_line=a,this.fixed_x=b,this.fixed_y=c,this.fixed_z=d,this.radius_x=e,this.radius_y=f,this.radius_z=g,this.reflectionProperties=h,this.radius_x_2=Math.square(this.radius_x),this.radius_y_2=Math.square(this.radius_y),this.radius_z_2=Math.square(this.radius_z)}return a.prototype.norm=function(a){var b,c;return b=$V([this.fixed_x?0:a.e(1)/this.radius_x_2,this.fixed_y?0:a.e(2)/this.radius_y_2,this.fixed_z?0:a.e(3)/this.radius_z_2]),c=b.subtract(this.axis_line),c.toUnitVector()},a.prototype.intersects=function(a){var b,c,d,e,f,g,h,i,j;return f=a.line.anchor.subtract(this.axis_line),e=a.line.direction.toUnitVector(),b=(this.fixed_x?0:e.e(1)*e.e(1)/this.radius_x_2)+(this.fixed_y?0:e.e(2)*e.e(2)/this.radius_y_2)+(this.fixed_z?0:e.e(3)*e.e(3)/this.radius_z_2),c=(this.fixed_x?0:2*f.e(1)*e.e(1)/this.radius_x_2)+(this.fixed_y?0:2*f.e(2)*e.e(2)/this.radius_y_2)+(this.fixed_z?0:2*f.e(3)*e.e(3)/this.radius_z_2),d=(this.fixed_x?0:f.e(1)*f.e(1)/this.radius_x_2)+(this.fixed_y?0:f.e(2)*f.e(2)/this.radius_y_2)+(this.fixed_z?0:f.e(3)*f.e(3)/this.radius_z_2)-1,j=Math.square(c)-4*b*d,0>j||0===b||0===c||0===d?null:(g=Math.sqrt(j),h=(-c+g)/(2*b),i=(-c-g)/(2*b),h<RayConfig.intersectionDelta?i:i<RayConfig.intersectionDelta?h:Math.min(h,i))},a.prototype.intersection=function(a){var b,c,d;return(b=this.intersects(a))?(c=a.line.anchor.add(a.line.direction.multiply(b)),d=this.norm(c),[b,c,d]):!1},a}(),d=function(){function a(a,b,c,d,e){this.center=a,this.radius_x=b,this.radius_y=c,this.radius_z=d,this.reflectionProperties=e,this.radius_x_2=Math.square(this.radius_x),this.radius_y_2=Math.square(this.radius_y),this.radius_z_2=Math.square(this.radius_z)}return a.prototype.norm=function(a){var b,c;return b=a.subtract(this.center),c=$M([[2/this.radius_x_2,0,0],[0,2/this.radius_y_2,0],[0,0,2/this.radius_z_2]]),b=c.multiply(b),b.toUnitVector()},a.prototype.intersects=function(a){var b,c,d,e,f,g,h,i,j;return f=a.line.anchor.subtract(this.center),e=a.line.direction.toUnitVector(),b=e.e(1)*e.e(1)/this.radius_x_2+e.e(2)*e.e(2)/this.radius_y_2+e.e(3)*e.e(3)/this.radius_z_2,c=2*f.e(1)*e.e(1)/this.radius_x_2+2*f.e(2)*e.e(2)/this.radius_y_2+2*f.e(3)*e.e(3)/this.radius_z_2,d=f.e(1)*f.e(1)/this.radius_x_2+f.e(2)*f.e(2)/this.radius_y_2+f.e(3)*f.e(3)/this.radius_z_2-1,j=c*c-4*b*d,0>j||0===b||0===c?null:(g=Math.sqrt(j),h=(-c+g)/(2*b),i=(-c-g)/(2*b),h<RayConfig.intersectionDelta?i:i<RayConfig.intersectionDelta?h:Math.min(h,i))},a.prototype.intersection=function(a){var b,c,d;return(b=this.intersects(a))?(c=a.line.anchor.add(a.line.direction.multiply(b)),d=this.norm(c),[b,c,d]):!1},a}(),e=function(){function a(a,b,c){this.location=a,this.color=b,this.intensity=c}return a}(),f=function(){function a(a,b,c){this.ambient=a,this.diffuse=b,this.specular=c}return a}(),g=function(){function a(a,b,c){this.line=a,this.refraction=b,this.power=c}return a.prototype.isInside=function(){return 1!==this.refraction},a}(),this.ModuleId={B1:void 0,B2:void 0,B3:void 0,B4:void 0,C1:void 0,C2:void 0,C3:void 0,D1:void 0,D2:void 0,ALT:void 0,SP1:void 0},"undefined"!=typeof document&&null!==document&&"undefined"!=typeof $&&null!==$&&$(document).ready(function(){var a,b,c,d,e,f;-1!==document.location.toString().indexOf("?")&&(d=document.location.toString().replace(/^.*?\?/,"").replace("#","").split("&"),d.forEach(function(a){var b,c,d;return c=a.split("="),b=c[0],d=c[1],d=void 0===d||"1"===d||"true"===d?!0:!1,ModuleId[b]=d})),f=[];for(b in ModuleId)e=ModuleId[b],a=document.createElement("input"),a.type="checkbox",a.value=1,a.name=b,a.id=b,e&&a.setAttribute("checked","checked"),c=document.createElement("label"),c.setAttribute("class","btn btn-primary"+(e?" active":"")),c.appendChild(a),$(c).data("option",b),c.innerHTML+=b,f.push($("#renderOptions").append(c));return f}),this.initRayConfig=function(){return this.RayConfig={width:800,height:600,illumination:!0,reflection:ModuleId.B1,refraction:ModuleId.B1,antialiasing:ModuleId.B2?4:1,recDepth:5,intersectionDelta:1e-6}},initRayConfig(),h=function(){function a(a,b,c,d){this.color=a,this.pixelX=b,this.pixelY=c,this.scene=d}return a.prototype.trace=function(){var a,c,d,e,f=this;return d=this.castRays(RayConfig.antialiasing),console.setRlog(),e=function(a){return f.traceRec(a,new b(0,0,0),RayConfig.recDepth)},c=d.map(function(a){return e(a)}),a=c.map(function(a){return a.toVector()}).reduce(function(a,b){return a.add(b)}).multiply(1/c.length),this.color.setElements(a.elements)},a.prototype.traceRec=function(a,b,c){var d,e,f,g,h,i,j,k,l,m;if(f=this.scene.firstIntersection(a),!f)return b;if(j=f[0],h=f[1],i=f[2],d=this.scene.globalAmbient,e=i.reflectionProperties.ambientColor.multiply(d),b=b.add(e),RayConfig.illumination)for(m=this.scene.lights,k=0,l=m.length;l>k;k++)g=m[k],b=b.add(this.illuminate(j,i,a,g));return 0>=c?b:RayConfig.reflection?b.add(this.reflectAndRefract(j,i,h,a,c)):void 0},a.prototype.reflectAndRefract=function(a,c,d,e,f){var g,h,i,j,k,l;return l=this.specularRays(a,c,d,e),h=l[0],i=l[1],g=new b(0,0,0),null!=h&&(j=this.traceRec(h,new b(0,0,0),f-1),j=j.multiplyColor(c.reflectionProperties.specularColor),g=g.add(j.multiply(h.power))),null!=i&&(k=this.traceRec(i,new b(0,0,0),f-1),k=k.multiplyColor(c.reflectionProperties.specularColor),g=g.add(k.multiply(i.power))),g},a.prototype.specularRays=function(a,b,c,d){var e,f,h,i,j,k,l,m,n,o,p,q,r,s,t;if(j=c,d.isInside()&&(j=j.multiply(-1)),h=a.subtract(d.line.anchor).toUnitVector(),k=d.refraction,l=d.isInside()?1:b.reflectionProperties.refractionIndex,i=h.dot(j),e=-i,p=h.add(j.multiply(2*e)).toUnitVector(),1/0===l)return[new g($L(a,p),k,d.power),null];if(o=k/l,t=Math.square(o)*(1-Math.square(e)),t>1)return[new g($L(a,p),k,d.power),null];if(f=Math.sqrt(1-t),r=h.multiply(o).add(j.multiply(o*e-f)).toUnitVector(),m=Math.square((k*e-l*f)/(k*e+l*f)),n=Math.square((l*e-k*f)/(l*e+k*f)),q=(m+n)/2,s=1-q,!(q>=0&&1>=q&&s>=0&&1>=s))return[new g($L(a,p),k,d.power),null];if(!(q>=0&&1>=q&&s>=0&&1>=s))throw"Invalid state: reflectionPowerRatio: "+q+", refractionPowerRatio: "+s;return[new g($L(a,p),k,d.power*q),new g($L(a,r),l,d.power*s)]},a.prototype.illuminate=function(a,c,d,e){var f,h,i,j,k,l,m,n,o,p,q,r,s,t;return o=c.norm(a),r=d.line.direction,s=e.location.subtract(a).toUnitVector(),t=o.multiply(2).multiply(r.dot(o)).subtract(r).toUnitVector(),this.scene.firstIntersection(new g($L(a,s),d.refraction,1))?new b(0,0,0):(h=e.intensity.ambient,i=c.reflectionProperties.ambientColor.multiply(h),l=c.reflectionProperties.diffuseColor,f=e.intensity.diffuse*o.dot(s),j=l.multiply(f*e.intensity.diffuse),n=c.reflectionProperties.specularExponent,m=c.reflectionProperties.specularColor,k=Math.pow(t.dot(s),n)/o.dot(s),q=k*f,0>k&&(q=0),p=m.multiply(q),i.add(j).add(p))},a.prototype.castRays=function(a){var b,c,d,e,f,h=this;return c=this.scene.camera,c=this.scene.camera,e=c.width*a,d=c.height*a,b=(1+a)/2,function(){f=[];for(var b=1;a>=1?a>=b:b>=a;a>=1?b++:b--)f.push(b);return f}.apply(this).map(function(d){var e;return function(){e=[];for(var b=1;a>=1?a>=b:b>=a;a>=1?b++:b--)e.push(b);return e}.apply(this).map(function(e){var f,i,j,k;return j=h.pixelX+d/a-b+.5-c.width/2,k=-1*(h.pixelY+e/a-b+.5-c.height/2),i=c.imageCenter.add(c.upDirection.multiply(k/c.height*c.imagePaneHeight)),i=i.add(c.rightDirection.multiply(j/c.width*c.imagePaneWidth)),f=i.subtract(c.position).toUnitVector(),new g($L(c.position,f),1,1)})}).reduce(function(a,b){return a.concat(b)})},a}(),this.RayTracer=h,i=function(){function a(a,b,c,d,e){this.ambientColor=a,this.diffuseColor=b,this.specularColor=c,this.specularExponent=d,this.refractionIndex=e}return a}(),j=function(){function a(a,b){this.camera=a,this.globalAmbient=b,this.objects=[],this.lights=[]}return a.prototype.addLight=function(a){return this.lights.push(a)},a.prototype.addObject=function(a){return this.objects.push(a)},a.prototype.firstIntersection=function(a){var b,c;return b=1/0,c=null,this.objects.forEach(function(d){var e,f,g,h;return h=d.intersection(a),e=h[0],f=h[1],g=h[2],e&&b>e&&e>RayConfig.intersectionDelta?(b=e,c=[f,g,d]):void 0}),c},a}(),k=function(){function g(){this.scene=this.loadDefaults()}return g.prototype.loadDefaults=function(){var c,d,g;return d=40/180*Math.PI,c=new a($V([0,0,10]),$V([0,0,-1]),$V([0,1,0]),1,d,RayConfig.width,RayConfig.height),g=new j(c,.2),g.addLight(new e($V([10,10,10]),new b(1,1,1),new f(0,1,1))),g},g.prototype.loadScene=function(){var a;return a=this.scene,ModuleId.ALT?this.loadAlternative(a):ModuleId.B3?this.loadB3(a):ModuleId.B4?this.loadB4(a):this.loadOriginal(a),a},g.prototype.loadOriginal=function(a){return a.addObject(new l($V([0,0,0]),2,new i(new b(.75,0,0),new b(1,0,0),new b(1,1,1),32,1/0))),a.addObject(new l($V([1.25,1.25,3]),.5,new i(new b(0,0,.75),new b(0,0,1),new b(.5,.5,1),16,1.5)))},g.prototype.loadB3=function(a){return a.addObject(new c($V([0,0,0]),!1,!0,!1,2,0,1,new i(new b(.75,0,0),new b(1,0,0),new b(1,1,1),32,1/0))),a.addObject(new d($V([1.25,1.25,3]),.25,.75,.5,new i(new b(0,0,.75),new b(0,0,1),new b(.5,.5,1),16,1.5))),ModuleId.SP1?(a.addObject(new l($V([2.25,1.25,3]),.5,new i(new b(0,0,.75),new b(0,0,1),new b(.5,.5,1),16,1.5))),a.addObject(new l($V([-1.25,-1.25,3]),.5,new i(new b(0,0,.75),new b(0,0,1),new b(.5,.5,1),16,1.5))),a.addObject(new l($V([0,0,3]),.5,new i(new b(1,0,.75),new b(0,0,1),new b(.5,.5,1),16,1.5)))):void 0},g.prototype.loadB4=function(a){var c,d;return c=new l($V([1.25,1.25,3]),.5,null),d=new l($V([.25,1.25,3]),1,null),a.addObject(new m(c,d,new i(new b(0,0,.75),new b(0,0,1),new b(.5,.5,1),16,1/0))),c=new l($V([.5,0,3]),.6,null),d=new l($V([-.5,0,3]),.6,null),c=new l($V([0,0,3]),.6,null),d=new l($V([0,0,4]),.6,null),a.addObject(new m(c,d,new i(new b(0,0,.75),new b(0,0,1),new b(.5,.5,1),16,1/0)))},g.prototype.loadAlternative=function(a){var c;return c=b.random(),a.addObject(new l($V([0,0,0]),2,new i(c,c,new b(1,1,1),32,1.5))),c=b.random(),a.addObject(new l($V([1.25,1.25,3]),.5,new i(c,c,new b(.5,.5,1),16,1.5))),c=b.random(),a.addObject(new l($V([1.25,-1.25,3]),.5,new i(c,c,new b(.5,.5,1),16,1.5))),c=b.random(),a.addObject(new l($V([0,-.75,3]),.5,new i(c,c,new b(.5,.5,1),16,1.5))),a.addObject(new l($V([2.5,0,-1]),.5,new i(new b(0,0,.75),new b(0,0,1),new b(.5,.5,1),16,1.5)))},g}(),this.SceneLoader=k,this.trace=function(a,b,c,d){var e;return e=new h(b,c,d,a),e.trace()},l=function(){function a(a,b,c){this.center=a,this.radius=b,this.reflectionProperties=c,this.radiusSquared=this.radius*this.radius}return a.prototype.norm=function(a){return a.subtract(this.center).toUnitVector()},a.prototype.intersects=function(a){var b,c,d,e,f,g,h,i,j,k;return f=a.line.anchor,d=a.line.direction,b=this.center,c=b.subtract(f),e=c.dot(c),g=c.dot(d),0>g?!1:(h=e-g*g,h>this.radiusSquared?!1:(k=this.radiusSquared-h,0>k?!1:(i=g-Math.sqrt(k),j=g+Math.sqrt(k),i<RayConfig.intersectionDelta?j:j<RayConfig.intersectionDelta?i:Math.min(i,j))))},a.prototype.intersection=function(a){var b,c,d;return(b=this.intersects(a))?(c=a.line.anchor.add(a.line.direction.multiply(b)),d=this.norm(c),[b,c,d]):!1},a}(),m=function(){function a(a,b,c){this.sphere1=a,this.sphere2=b,this.reflectionProperties=c}return a.prototype.norm=function(a){var b,c;return b=this.sphere1.intersects(this.ray),c=this.sphere2.intersects(this.ray),b>c?this.sphere1.norm(a):this.sphere2.norm(a)},a.prototype.intersects=function(a){var b,c;return this.ray=a,b=this.sphere1.intersects(a),c=this.sphere2.intersects(a),b&&c?Math.min(b,c):!1},a.prototype.intersection=function(a){var b,c,d;return(b=this.intersects(a))?(c=a.line.anchor.add(a.line.direction.multiply(b)),d=this.norm(c),[b,c,d]):!1},a}(),console.setRlog=function(a){return null==a&&(a=1e-4),this.shoulLog=Math.random()<=a},console.rlog=function(a){return this.shoulLog?console.log(a):void 0},Math.square=function(a){return a*a}}).call(this);
//# sourceMappingURL=./public/out/compiled.min.js.map