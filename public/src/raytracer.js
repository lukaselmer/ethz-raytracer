// Generated by CoffeeScript 1.6.3
(function() {
  var Camera, Color, Light, LightIntensity, Ray, RayTracer, ReflectionProperty, Scene, Sphere;

  Color = (function() {
    function Color(r, g, b) {
      this.r = r;
      this.g = g;
      this.b = b;
    }

    Color.prototype.toArray = function() {
      return [this.r, this.g, this.b];
    };

    return Color;

  })();

  Scene = (function() {
    function Scene(camera, light) {
      this.camera = camera;
      this.light = light;
      this.objects = [];
    }

    Scene.prototype.addObject = function(object) {
      return this.objects[this.objects.length] = object;
    };

    Scene.prototype.intersections = function(ray) {
      var object, _i, _len, _ref, _results;
      _ref = this.objects;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        object = _ref[_i];
        if (object.intersects(ray)) {
          _results.push(object);
        }
      }
      return _results;
    };

    return Scene;

  })();

  Camera = (function() {
    function Camera(position, direction, upDirection, fieldOfView, width, height) {
      this.position = position;
      this.direction = direction;
      this.upDirection = upDirection;
      this.fieldOfView = fieldOfView;
      this.width = width;
      this.height = height;
      this.calibrateCamera();
    }

    Camera.prototype.calibrateCamera = function() {
      this.rightDirection = this.direction.cross(this.upDirection);
      return this.upDirection = this.rightDirection.cross(this.direction);
    };

    Camera.prototype.getCenter = function() {
      return this.position.add(this.direction);
    };

    return Camera;

  })();

  Light = (function() {
    function Light(color, location, intensity) {
      this.color = color;
      this.location = location;
      this.intensity = intensity;
    }

    return Light;

  })();

  LightIntensity = (function() {
    function LightIntensity(ambient, diffuse, specular, globalAmbient) {
      this.ambient = ambient;
      this.diffuse = diffuse;
      this.specular = specular;
      this.globalAmbient = globalAmbient;
    }

    return LightIntensity;

  })();

  ReflectionProperty = (function() {
    function ReflectionProperty(ambientColor, diffuseColor, specularColor, specularExponent) {
      this.ambientColor = ambientColor;
      this.diffuseColor = diffuseColor;
      this.specularColor = specularColor;
      this.specularExponent = specularExponent;
    }

    return ReflectionProperty;

  })();

  Sphere = (function() {
    function Sphere(center, radius, reflectionProperties) {
      this.center = center;
      this.radius = radius;
      this.reflectionProperties = reflectionProperties;
    }

    Sphere.prototype.intersects = function(ray) {
      return false;
    };

    return Sphere;

  })();

  Ray = (function() {
    function Ray(line) {
      this.line = line;
    }

    return Ray;

  })();

  RayTracer = (function() {
    function RayTracer(color, pixelX, pixelY, scene) {
      this.color = color;
      this.pixelX = pixelX;
      this.pixelY = pixelY;
      this.scene = scene;
    }

    RayTracer.prototype.trace = function() {
      var c, intersections, rayDirection;
      rayDirection = this.castRay();
      intersections = this.scene.intersections(rayDirection);
      if (intersections.length > 0) {
        console.log(intersections.length);
      }
      c = new Color(this.pixelX / width, this.pixelY / height * 0.9, this.pixelX * this.pixelY / (width * height / 2));
      return this.color.setElements(c.toArray());
    };

    RayTracer.prototype.castRay = function() {
      var camera, centerPixelX, centerPixelY, height, width, _ref, _ref1;
      camera = scene.camera;
      _ref = [camera.width, camera.height], width = _ref[0], height = _ref[1];
      _ref1 = [(this.pixelX / width) - 0.5, (this.pixelY / height) - 0.5], centerPixelX = _ref1[0], centerPixelY = _ref1[1];
      return camera.rightDirection.multiply(centerPixelX).add(camera.upDirection.multiply(centerPixelY)).add(camera.direction);
    };

    return RayTracer;

  })();

  this.loadScene = function() {
    var camera, light, scene;
    camera = new Camera($V([0, 0, 10]), $V([0, 0, -1]), $V([0, 1, 0]), 40, 800, 600);
    light = new Light(new Color(1, 1, 1), [10, 10, 10], new LightIntensity(0, 1, 1, 0.2));
    scene = new Scene(camera, light);
    scene.addObject(new Sphere([0, 0, 0], 2, new ReflectionProperty(new Color(0.75, 0, 0), new Color(1, 0, 0), new Color(1, 1, 1), 32)));
    scene.addObject(new Sphere([1.25, 1.25, 3], 0.5, new ReflectionProperty(new Color(0, 0, 0.75), new Color(0, 0, 1), new Color(0.5, 0.5, 1), 16)));
    return this.scene = scene;
  };

  this.trace = function(color, pixelX, pixelY) {
    var rayTracer;
    rayTracer = new RayTracer(color, pixelX, pixelY, scene);
    return rayTracer.trace();
  };

}).call(this);

/*
//@ sourceMappingURL=raytracer.map
*/
